{"version":3,"sources":["api/github.ts","api/npm.ts","api/plainapi.ts","components/downloads-options.tsx","store/index.tsx","components/downloads.tsx","components/header.tsx","components/empty.tsx","components/release.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Octokit","baseUrl","request","axios","create","baseURL","baseFetcher","url","get","rangeFetcher","libsStr","scopeLibsStr","libsUrl","scopeLibs","split","libsPromise","Promise","resolve","reject","then","res","catch","e","scopePromiseList","map","lib","response","status","console","error","all","libsData","scopeDataList","result","i","length","scopeData","data","useNpmRangeData","period","packages","filter","p","startsWith","sort","libs","push","useSWR","join","process","fetchLibInfos","a","params","range","onRangeChange","timeType","onTimeTypeChange","excludeWeekends","onExcludeChange","Group","value","onChange","target","size","checked","disabled","type","style","height","RangePicker","ranges","moment","subtract","disabledDate","cur","now","diff","LibsContext","React","createContext","queryReg","LibsProvider","children","useState","setLibs","search","useLocation","useEffect","query","decodeURIComponent","match","Provider","useLibs","useContext","lastYear","lastYearStr","r","format","dateRange","setDateRange","rangeStr","setRangeStr","setTimeType","setExcludeWeekends","downloads","isValidating","useMemo","reduce","n","packageDownloads","concat","dl","dataWithoutWeekends","day","isoWeekday","dataWeekly","reduceRight","libDownloads","lastDay","item","ld","diffDay","duration","unshift","title","extra","rangeStrs","padding","autoFit","scale","min","name","label","formatter","text","numeral","divide","shape","area","position","color","tooltip","dls","top","left","transform","description","history","useHistory","libsInUrl","newLib","setNewLib","prevLibs","addNewLib","useCallback","includes","backIcon","href","fontSize","GithubOutlined","direction","display","key","closable","onClose","l","onPressEnter","width","placeholder","addonAfter","onClick","border","danger","EmptyInfo","onlyStable","setOnlyStable","useLibInfos","libInfos","releaseData","info","versions","v","date","published_at","version","number","year","month","b","stableReleaseData","d","values","ticks","adjust","marginRatio","Content","Layout","App","basename","className","minHeight","path","revalidateOnFocus","shouldRetryOnError","Boolean","window","location","hostname","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.96538be4.chunk.js","sourcesContent":["import { Octokit } from '@octokit/rest'\nimport useSWR from 'swr'\n\nexport const octokit = new Octokit({\n  baseUrl: 'https://api.github.com',\n})\n\n/**\n * 获取仓库数据\n * @param owner \n * @param repo \n */\nexport const useRepoData = (owner: string, repo: string) => useSWR(\n  ['GET /repos/{owner}/{repo}', owner, repo],\n  (url, owner, repo) => octokit.request(url, {\n    owner,\n    repo,\n  })\n)\n","import axios, { AxiosResponse } from 'axios'\nimport useSWR from 'swr'\n\nconst request = axios.create({\n  baseURL: 'https://api.npmjs.org/',\n})\n\ntype Period = string | 'last-week' | 'last-month'\n\n/**\n * 通过基础fetcher\n * @param url \n */\nconst baseFetcher = <T=any>(url: string) => request.get<any, AxiosResponse<T>>(url)\n\ninterface DownloadDataItem {\n  /**\n   * 下载量\n   */\n  downloads: number\n  /**\n   * 日期\n   */\n  day: string\n}\n\ninterface DownloadData {\n  downloads: DownloadDataItem[]\n}\n\n/**\n * rang下载量数据格式\n */\ninterface RangeData {\n  [libName: string]: DownloadData | null\n}\n\nconst rangeFetcher = (url: string, libsStr: string, scopeLibsStr: string) => {\n  const libsUrl = `${url}/${libsStr}`\n  const scopeLibs = scopeLibsStr ? scopeLibsStr.split(',') : []\n\n  // 获取普通js包的下载量\n  const libsPromise = new Promise<AxiosResponse<RangeData>>((resolve, reject) => {\n    baseFetcher<RangeData>(libsUrl)\n      .then((res) => resolve(res))\n      .catch((e) => reject(e))\n  })\n  // 每个scope形式的包单独请求\n  const scopePromiseList = scopeLibs.map(lib => new Promise<AxiosResponse<DownloadData> | null>((resolve, reject) => {\n    request.get<any, AxiosResponse<DownloadData>>(`${url}/${lib}`)\n      .then((res) => {\n        resolve(res)\n      })\n      .catch((e) => {\n        if (e.response.status === 404) {\n          resolve(null)\n        } else {\n          console.error(e)\n          reject(e)\n        }\n      })\n  }))\n\n  return new Promise<RangeData>((resolve, reject) => {\n    Promise.all<AxiosResponse<RangeData> | AxiosResponse<DownloadData> | null>([libsPromise, ...scopePromiseList])\n      .then(([libsData, ...scopeDataList]) => {\n        const result = libsData as AxiosResponse<RangeData>\n        for(let i = 0; i < scopeLibs.length; i++) {\n          const scopeData = scopeDataList[i] as AxiosResponse<DownloadData> | null\n          result.data[scopeLibs[i]] = scopeData?.data || null\n        }\n\n        resolve(result.data)\n      })\n      .catch((e) => {\n        console.error(e)\n        reject(e)\n      })\n  })\n}\n\n/**\n * 获取一段时间内每天的下载量\n * @param period \n * @param packages \n */\nexport const useNpmRangeData = (period: Period, ...packages: string[]) => {\n  // npm不支持批量查询scope形式的js包，如\"@babel/core\"，所以需要单独处理\n  const scopeLibs = packages.filter(p => p.startsWith('@')).sort()\n  // 普通包名\n  const libs = packages.filter(p => !p.startsWith('@')).sort()\n  if (libs.length === 1) {\n    libs.push('_placeholder_')\n  }\n\n  return useSWR(\n    packages.length > 0 ? [`/downloads/range/${period}`, libs.join(','), scopeLibs.join(',')] : null,\n    rangeFetcher,\n  )\n}\n\nexport const useNpmMetaData = (packageName: string) => useSWR(\n  `/${packageName}`,\n  baseFetcher,\n)\n","import axios, { AxiosResponse } from 'axios'\nimport useSWR from 'swr'\n\nconst baseURL = `${process.env.REACT_APP_PLAINAPI_BASE_URL}jslib-compare`\nconst request = axios.create({\n  baseURL,\n})\n\n/**\n * 版本信息\n */\nexport interface Version {\n  /**\n   * 版本号\n   */\n  number: string\n  /**\n   * 发版日期\n   */\n  published_at: string\n}\n\n/**\n * js lib info\n */\nexport interface LibInfo {\n  /**\n   * package名称\n   */\n  name: string\n  /**\n   * 源码仓库地址\n   */\n  repository_url: string\n  /**\n   * 网站地址\n   */\n  homepage: string\n  /**\n   * 版本发布历史数据\n   */\n  versions: Version[]\n  /**\n   * \n   */\n  dependent_repos_count: number\n  /**\n   * \n   */\n  dependents_count: number\n  /**\n   * forks\n   */\n  forks: number\n  licenses: string\n  rank: number\n  stars: number\n  /**\n   * npm url\n   */\n  package_manager_url: string\n}\n\nconst fetchLibInfos = async (libs: string) => {\n  const res = await request.get<any, AxiosResponse<{ [lib: string]: LibInfo | null }>>(`/release`, { params: { libs } })\n  return res.data\n}\n\n/**\n * js libraries info data\n * @param packages package names on npm\n */\nexport const useLibInfos = (packages: string[]) => {\n  const libs = packages.join(',')\n\n  return useSWR(\n    packages.length > 0 ? [libs, baseURL] : null,\n    fetchLibInfos,\n  )\n}\n","import React from 'react'\nimport { DatePicker, Divider, Radio, Space, Switch } from 'antd'\nimport moment from 'moment'\n\nexport type Range = [moment.Moment | null, moment.Moment | null]\nexport type TimeType = 'daily' | 'weekly'\n\ninterface OptionsProps {\n  range: Range | null\n  onRangeChange: (range: Range | null, rangeStr: [string, string]) => void\n\n  timeType: TimeType\n  onTimeTypeChange: (timeType: TimeType) => void\n\n  /**\n   * 是否排除周末\n   */\n  excludeWeekends: boolean\n  onExcludeChange: (exclude: boolean) => void\n}\n\nexport default ({\n  range,\n  onRangeChange,\n  timeType,\n  onTimeTypeChange,\n  excludeWeekends,\n  onExcludeChange,\n}: OptionsProps) => {\n  return (\n    <div>\n      <Space>\n        <Radio.Group value={timeType} onChange={(e) => onTimeTypeChange(e.target.value)}>\n          <Radio value='weekly'>weekly</Radio>\n          <Radio value='daily'>daily</Radio>\n        </Radio.Group>\n        <Switch size='small' checked={excludeWeekends} onChange={onExcludeChange} disabled={timeType === 'weekly'} />\n        <span>exclude weekends</span>\n        <Divider type='vertical' style={{ height: '1.3em'}} />\n        <DatePicker.RangePicker\n          ranges={{\n            'last-week': () => [moment().subtract(1, 'week'), moment().subtract(1, 'day')],\n            'last-month': () => [moment().subtract(1, 'month'), moment().subtract(1, 'day')],\n            'last-year': () => [moment().subtract(1, 'year'), moment().subtract(1, 'day')],\n          }}\n          disabledDate={(cur) => {\n            const now = moment()\n            return now.subtract(1, 'day').diff(cur, 'year') >= 1 || now.diff(cur, 'day') <= 0\n          }}\n          value={range}\n          onChange={onRangeChange}\n          size='small'\n        />\n      </Space>\n    </div>\n  )\n}","import React, { useContext, useEffect, useState } from 'react'\nimport { useLocation } from 'react-router-dom'\n\nconst LibsContext = React.createContext<string[]>([])\n\nconst queryReg = /^\\?libs=(.+)$/\n\nexport const LibsProvider: React.FC = ({ children}) => {\n  const [libs, setLibs] = useState<string[]>([])\n  const { search } = useLocation()\n  \n  useEffect(() => {\n    const query = decodeURIComponent(search).match(queryReg)\n    setLibs(query ? query[1].split(',') : [])\n  }, [search])\n\n  return (\n    <LibsContext.Provider value={libs}>\n      {children}\n    </LibsContext.Provider>\n  )\n}\n\nexport const useLibs = () => useContext(LibsContext)","import React, { useState, useMemo } from 'react'\nimport { Card, Empty } from 'antd'\nimport { Axis, Chart, LineAdvance } from 'bizcharts'\nimport numeral from 'numeral'\nimport moment from 'moment'\nimport { useNpmRangeData } from '../api'\nimport Options, { Range, TimeType } from './downloads-options'\nimport { useLibs } from '../store'\n\n\ninterface DataItem {\n  downloads: number\n  day: string\n  lib: string\n  duration?: string\n}\n\nconst lastYear = [moment().subtract(1, 'year'), moment().subtract(1, 'day')]\nconst lastYearStr = lastYear.map(r => r.format('YYYY-MM-DD')).join(':')\n\nexport default () => {\n  const libs = useLibs()\n  const [dateRange, setDateRange] = useState<Range | null>(lastYear as Range)\n  const [rangeStr, setRangeStr] = useState(lastYearStr)\n  const [timeType, setTimeType] = useState<TimeType>('weekly')\n  const [excludeWeekends, setExcludeWeekends] = useState(true)\n  const { data: downloads, error, isValidating } = useNpmRangeData(rangeStr || lastYearStr, ...libs)\n\n  const data = useMemo(() => {\n    if (!downloads) {\n      return []\n    }\n    \n    const dd = libs.reduce<DataItem[]>((r, n) => {\n      const packageDownloads = downloads[n]\n      if (packageDownloads) {\n        return r.concat(packageDownloads.downloads.map(\n          (dl) => ({ ...dl, lib: n })\n        ))\n      }\n\n      return r\n    }, [])\n\n    return dd\n  }, [downloads, libs])\n\n  // 排除掉周末的数据\n  const dataWithoutWeekends = useMemo(() => {\n    return data.filter(({ day }) => moment(day).isoWeekday() < 6)\n  }, [data])\n\n  // 按周汇总的数据\n  const dataWeekly = useMemo(() => {\n    if (!downloads) {\n      return []\n    }\n\n    return libs.reduceRight<DataItem[]>((result, lib) => {\n      const libDownloads = downloads[lib]?.downloads || []\n      \n      let lastDay: moment.Moment | null = null\n      let item: DataItem = {\n        downloads: 0,\n        lib,\n        day: '',\n      }\n\n      for(let i = libDownloads.length - 1; i >= 0; i--) {\n        const ld = libDownloads[i]\n        const day = moment(ld.day)\n        if (!lastDay) {\n          lastDay = moment(ld.day)\n        }\n\n        const diffDay = lastDay.diff(day, 'day')\n        if (diffDay <= 6) {\n          item.downloads += ld.downloads\n        }\n        // 第七天 保存数据\n        if (diffDay === 6) {\n          item.duration = `${day.format('YYYY-MM-DD')} to ${lastDay.format('YYYY-MM-DD')}`\n          item.day = lastDay.format('YYYY-MM-DD')\n          result.unshift(item)\n\n          // 初始化下一个七天\n          lastDay = null\n          item = {\n            day: '',\n            downloads: 0,\n            lib,\n          }\n        }\n      }\n\n      return result\n    }, [])\n  }, [downloads, libs])\n\n  return (\n    <Card\n      title='NPM Downloads'\n      extra={(\n        <Options\n          range={dateRange}\n          onRangeChange={(range, rangeStrs) => {\n            setDateRange(range)\n            setRangeStr(range ? rangeStrs.join(':') : '')\n          }}\n          timeType={timeType}\n          onTimeTypeChange={setTimeType}\n          excludeWeekends={excludeWeekends}\n          onExcludeChange={setExcludeWeekends}\n        />\n      )}\n    >\n      <Chart\n        padding={[10, 50, 50]}\n        height={300}\n        autoFit\n        data={timeType === 'weekly' ? dataWeekly : excludeWeekends ? dataWithoutWeekends : data}\n        scale={{\n          downloads: {\n            min: 0,\n          }\n        }}\n      >\n        <Axis\n          name='downloads'\n          label={{\n            formatter: (text) => `${numeral(text).divide(1000).value()}K`\n          }}\n        />\n        <LineAdvance\n          shape='smooth'\n          area\n          position='day*downloads'\n          color='lib'\n          tooltip={[\n            'lib*downloads*duration*day',\n            (name, dls, duration, day) => ({\n              name,\n              value: numeral(dls).format('0,0'),\n              title: duration || day\n            })\n          ]}\n        />\n        {downloads ? null : (\n          <Empty\n            style={{\n              position: 'absolute',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)',\n            }}\n            description={error || isValidating ? 'loading...' : 'No Data'}\n          />\n        )}\n      </Chart>\n    </Card>\n  )\n}\n","import React, { useState, useCallback, useEffect } from 'react'\nimport { PageHeader, Space, Input, Tag, Button } from 'antd'\nimport { GithubOutlined } from '@ant-design/icons'\nimport { useHistory } from 'react-router-dom'\nimport { useLibs } from '../store'\n\nexport default () => {\n  const history = useHistory()\n  const libsInUrl = useLibs()\n  const [libs, setLibs] = useState<string[]>(libsInUrl)\n  const [newLib, setNewLib] = useState<string>('')\n\n  useEffect(() => {\n    setLibs(prevLibs => {\n      if (prevLibs.join(',') !== libsInUrl.join(',')) {\n        return libsInUrl\n      }\n\n      return prevLibs\n    })\n  }, [libsInUrl])\n\n  const addNewLib = useCallback(() => {\n    if (newLib) {\n      setLibs(libs => {\n        if (libs.includes(newLib)) {\n          return libs\n        }\n\n        return libs.concat(newLib)\n      })\n      setNewLib('')\n    }\n  }, [newLib])\n\n  return (\n    <PageHeader\n      title='JS Compare'\n      backIcon={false}\n      extra={(\n        <a\n          href='https://github.com/guofei0723/jslib-compare'\n          style={{\n            fontSize: '1.5em',\n            color: 'inherit',\n          }}\n        >\n          <GithubOutlined />\n        </a>\n      )}\n    >\n      <Space direction='vertical'>\n        <div style={{ display: 'inline-block' }}>\n          {libs.map(lib => (\n            <Tag\n              key={lib}\n              closable\n              onClose={() => setLibs(libs.filter(l => l !== lib))}\n            >\n              {lib}\n            </Tag>\n          ))}\n          <Space>\n            <Input\n              size='small'\n              type='text'\n              value={newLib}\n              onPressEnter={addNewLib}\n              onChange={(e) => setNewLib(e.target.value)}\n              style={{\n                width: '160px',\n              }}\n              placeholder='add js library'\n              addonAfter={(\n                <Button\n                  type='text'\n                  size='small'\n                  onClick={addNewLib}\n                  disabled={!newLib}\n                  style={{\n                    height: 22,\n                    border: 0,\n                    padding: 0,\n                  }}\n                >\n                  +\n                </Button>\n              )}\n            />\n            <Button\n              size='small'\n              danger\n              onClick={() => setLibs([])}\n              disabled={libs.length === 0}\n            >\n              clear\n            </Button>\n          </Space>\n        </div>\n        <Button\n          type='primary'\n          onClick={() => history.push(`/?libs=${libs.join(',')}`)}\n          disabled={libs === libsInUrl || libs.length === 0}\n        >\n          Compare\n        </Button>\n      </Space>\n    </PageHeader>\n  )\n}\n","import React from 'react'\nimport { Empty } from 'antd'\n\nconst EmptyInfo: React.FC = ({ children }) => {\n  return (\n    <Empty\n      style={{\n        position: 'absolute',\n        top: '50%',\n        left: '50%',\n        transform: 'translate(-50%, -50%)',\n      }}\n      description={children}\n    />\n  )\n}\n\nexport default EmptyInfo\n","import React, { useMemo, useState } from 'react'\nimport { Card, Space, Switch } from 'antd'\nimport { Chart, Interval } from 'bizcharts'\nimport EmptyInfo from './empty'\nimport { useLibs } from '../store'\nimport { useLibInfos } from '../api'\nimport moment from 'moment'\n\nexport default () => {\n  const [onlyStable, setOnlyStable] = useState(true)\n  const libs = useLibs()\n  const { data: libInfos, error, isValidating } = useLibInfos(libs)\n  const releaseData = useMemo(() => {\n    if (!libInfos) {\n      return []\n    }\n\n    return libs.reduce((r, lib) => {\n      const info = libInfos[lib]\n      if (info) {\n        return r.concat(info.versions.map(v => {\n          const date = moment(v.published_at)\n          return {\n            version: v.number,\n            name: lib,\n            date: date.format('YYYY-MM-DD'),\n            year: date.format('YYYY'),\n            month: `2020-${date.format('MM-DD HH:mm:ss')}`,\n          }\n        }))\n      }\n      return r\n    }, [] as any[]).sort((a, b) => a.date > b.date ? 1 : -1)\n  }, [libInfos, libs])\n\n  const stableReleaseData = useMemo(() => {\n    return releaseData.filter(d => !d.version.includes('-'))\n  }, [releaseData])\n\n  return (\n    <Card\n      title='NPM Release'\n      extra={(\n        <Space>\n          <Switch\n           checked={onlyStable}\n           onChange={setOnlyStable}\n           size='small'\n          />\n          <span>\n            Only Stable\n          </span>\n        </Space>\n      )}\n    >\n      <Chart\n        autoFit\n        height={300}\n        data={onlyStable ? stableReleaseData : releaseData}\n        scale={{\n          month: {\n            type: 'time',\n            values: ['2020-01-01', '2021-01-01'],\n            ticks: ['2020-03-01', '2020-06-01', '2020-09-01', '2020-12-01'],\n            formatter: (d: string) => moment(d).format('MMM'),\n          },\n          year: {\n            type: 'cat',\n          }\n        }}\n      >\n        <Interval\n          adjust={[\n          {\n              type: 'dodge',\n              marginRatio: 0,\n            },\n          ]}\n          color='name'\n          position='year*month'\n          shape='tick'\n          size={12}\n          tooltip={[\n            'name*version*date',\n            (name, version, date) => ({\n              name,\n              title: date,\n              value: version,\n            })\n          ]}\n        />\n        {libInfos ? null : (\n          <EmptyInfo>\n            {error || isValidating ? 'loading...' : 'No Data'}\n          </EmptyInfo>\n        )}\n      </Chart>\n    </Card>\n  )\n}","import React from 'react'\nimport { Layout, Space } from 'antd'\nimport {\n  BrowserRouter as Router,\n  Route,\n  Switch,\n} from 'react-router-dom'\nimport { SWRConfig } from 'swr'\nimport './App.less'\nimport { DownloadsChart, ReleaseChart, TheHeader } from './components'\nimport { LibsProvider } from './store'\n\nconst { Content } = Layout\n\nfunction App() {\n  return (\n    <Router basename={process.env.PUBLIC_URL}>\n      <div className='App'>\n        <Layout style={{ minHeight: '100%' }}>\n          <Content>\n            <Switch>\n              <Route path='/'>\n                <SWRConfig\n                  value={{\n                    revalidateOnFocus: false,\n                    shouldRetryOnError: false,\n                  }}\n                >\n                  <LibsProvider>\n                    <TheHeader />\n                    <Space direction='vertical' style={{ display: 'flex', padding: '0 24px'}} size='large'>\n                      <DownloadsChart />\n                      <ReleaseChart />\n                    </Space>\n                  </LibsProvider>\n                </SWRConfig>\n              </Route>\n            </Switch>\n          </Content>\n        </Layout>\n      </div>\n    </Router>\n  );\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config: any) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config: any) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config: any) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.less'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}