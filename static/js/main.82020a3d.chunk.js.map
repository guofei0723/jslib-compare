{"version":3,"sources":["api/github.ts","api/npm.ts","components/downloads-options.tsx","store/index.tsx","components/downloads.tsx","components/header.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["Octokit","baseUrl","request","axios","create","baseURL","baseFetcher","url","get","rangeFetcher","libsStr","scopeLibsStr","libsUrl","scopeLibs","split","libsPromise","Promise","resolve","reject","then","res","catch","e","scopePromiseList","map","lib","response","status","console","error","all","libsData","scopeDataList","result","i","length","scopeData","data","useNpmRangeData","period","packages","filter","p","startsWith","sort","libs","push","useSWR","join","range","onRangeChange","timeType","onTimeTypeChange","excludeWeekends","onExcludeChange","Group","value","onChange","target","size","checked","disabled","type","style","height","RangePicker","ranges","moment","subtract","disabledDate","cur","now","diff","LibsContext","React","createContext","queryReg","LibsProvider","children","useState","setLibs","search","useLocation","useEffect","query","decodeURIComponent","match","Provider","useLibs","useContext","lastYear","lastYearStr","r","format","dateRange","setDateRange","rangeStr","setRangeStr","setTimeType","setExcludeWeekends","downloads","isValidating","useMemo","reduce","n","packageDownloads","concat","dl","dataWithoutWeekends","day","isoWeekday","dataWeekly","reduceRight","libDownloads","lastDay","item","ld","diffDay","duration","unshift","title","extra","rangeStrs","padding","autoFit","scale","min","name","label","formatter","text","numeral","divide","shape","area","position","color","tooltip","dls","top","left","transform","description","history","useHistory","libsInUrl","newLib","setNewLib","prevLibs","addNewLib","useCallback","includes","backIcon","href","fontSize","GithubOutlined","direction","display","key","closable","onClose","l","onPressEnter","width","placeholder","addonAfter","onClick","border","danger","Content","Layout","App","basename","process","className","minHeight","path","revalidateOnFocus","shouldRetryOnError","Boolean","window","location","hostname","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.82020a3d.chunk.js","sourcesContent":["import { Octokit } from '@octokit/rest'\nimport useSWR from 'swr'\n\nexport const octokit = new Octokit({\n  baseUrl: 'https://api.github.com',\n})\n\n/**\n * 获取仓库数据\n * @param owner \n * @param repo \n */\nexport const useRepoData = (owner: string, repo: string) => useSWR(\n  ['GET /repos/{owner}/{repo}', owner, repo],\n  (url, owner, repo) => octokit.request(url, {\n    owner,\n    repo,\n  })\n)\n","import axios, { AxiosResponse } from 'axios'\nimport useSWR from 'swr'\n\nconst request = axios.create({\n  baseURL: 'https://api.npmjs.org/',\n})\n\ntype Period = string | 'last-week' | 'last-month'\n\n/**\n * 通过基础fetcher\n * @param url \n */\nconst baseFetcher = <T=any>(url: string) => request.get<any, AxiosResponse<T>>(url)\n\ninterface DownloadDataItem {\n  /**\n   * 下载量\n   */\n  downloads: number\n  /**\n   * 日期\n   */\n  day: string\n}\n\ninterface DownloadData {\n  downloads: DownloadDataItem[]\n}\n\n/**\n * rang下载量数据格式\n */\ninterface RangeData {\n  [libName: string]: DownloadData | null\n}\n\nconst rangeFetcher = (url: string, libsStr: string, scopeLibsStr: string) => {\n  const libsUrl = `${url}/${libsStr}`\n  const scopeLibs = scopeLibsStr ? scopeLibsStr.split(',') : []\n\n  // 获取普通js包的下载量\n  const libsPromise = new Promise<AxiosResponse<RangeData>>((resolve, reject) => {\n    baseFetcher<RangeData>(libsUrl)\n      .then((res) => resolve(res))\n      .catch((e) => reject(e))\n  })\n  // 每个scope形式的包单独请求\n  const scopePromiseList = scopeLibs.map(lib => new Promise<AxiosResponse<DownloadData> | null>((resolve, reject) => {\n    request.get<any, AxiosResponse<DownloadData>>(`${url}/${lib}`)\n      .then((res) => {\n        resolve(res)\n      })\n      .catch((e) => {\n        if (e.response.status === 404) {\n          resolve(null)\n        } else {\n          console.error(e)\n          reject(e)\n        }\n      })\n  }))\n\n  return new Promise<RangeData>((resolve, reject) => {\n    Promise.all<AxiosResponse<RangeData> | AxiosResponse<DownloadData> | null>([libsPromise, ...scopePromiseList])\n      .then(([libsData, ...scopeDataList]) => {\n        const result = libsData as AxiosResponse<RangeData>\n        for(let i = 0; i < scopeLibs.length; i++) {\n          const scopeData = scopeDataList[i] as AxiosResponse<DownloadData> | null\n          result.data[scopeLibs[i]] = scopeData?.data || null\n        }\n\n        resolve(result.data)\n      })\n      .catch((e) => {\n        console.error(e)\n        reject(e)\n      })\n  })\n}\n\n/**\n * 获取一段时间内每天的下载量\n * @param period \n * @param packages \n */\nexport const useNpmRangeData = (period: Period, ...packages: string[]) => {\n  // npm不支持批量查询scope形式的js包，如\"@babel/core\"，所以需要单独处理\n  const scopeLibs = packages.filter(p => p.startsWith('@')).sort()\n  // 普通包名\n  const libs = packages.filter(p => !p.startsWith('@')).sort()\n  if (libs.length === 1) {\n    libs.push('_placeholder_')\n  }\n\n  return useSWR(\n    packages.length > 0 ? [`/downloads/range/${period}`, libs.join(','), scopeLibs.join(',')] : null,\n    rangeFetcher,\n  )\n}\n\nexport const useNpmMetaData = (packageName: string) => useSWR(\n  `/${packageName}`,\n  baseFetcher,\n)\n","import React from 'react'\nimport { DatePicker, Divider, Radio, Space, Switch } from 'antd'\nimport moment from 'moment'\n\nexport type Range = [moment.Moment | null, moment.Moment | null]\nexport type TimeType = 'daily' | 'weekly'\n\ninterface OptionsProps {\n  range: Range | null\n  onRangeChange: (range: Range | null, rangeStr: [string, string]) => void\n\n  timeType: TimeType\n  onTimeTypeChange: (timeType: TimeType) => void\n\n  /**\n   * 是否排除周末\n   */\n  excludeWeekends: boolean\n  onExcludeChange: (exclude: boolean) => void\n}\n\nexport default ({\n  range,\n  onRangeChange,\n  timeType,\n  onTimeTypeChange,\n  excludeWeekends,\n  onExcludeChange,\n}: OptionsProps) => {\n  return (\n    <div>\n      <Space>\n        <Radio.Group value={timeType} onChange={(e) => onTimeTypeChange(e.target.value)}>\n          <Radio value='weekly'>weekly</Radio>\n          <Radio value='daily'>daily</Radio>\n        </Radio.Group>\n        <Switch size='small' checked={excludeWeekends} onChange={onExcludeChange} disabled={timeType === 'weekly'} />\n        <span>exclude weekends</span>\n        <Divider type='vertical' style={{ height: '1.3em'}} />\n        <DatePicker.RangePicker\n          ranges={{\n            'last-week': () => [moment().subtract(1, 'week'), moment().subtract(1, 'day')],\n            'last-month': () => [moment().subtract(1, 'month'), moment().subtract(1, 'day')],\n            'last-year': () => [moment().subtract(1, 'year'), moment().subtract(1, 'day')],\n          }}\n          disabledDate={(cur) => {\n            const now = moment()\n            return now.subtract(1, 'day').diff(cur, 'year') >= 1 || now.diff(cur, 'day') <= 0\n          }}\n          value={range}\n          onChange={onRangeChange}\n          size='small'\n        />\n      </Space>\n    </div>\n  )\n}","import React, { useContext, useEffect, useState } from 'react'\nimport { useLocation } from 'react-router-dom'\n\nconst LibsContext = React.createContext<string[]>([])\n\nconst queryReg = /^\\?libs=(.+)$/\n\nexport const LibsProvider: React.FC = ({ children}) => {\n  const [libs, setLibs] = useState<string[]>([])\n  const { search } = useLocation()\n  \n  useEffect(() => {\n    const query = decodeURIComponent(search).match(queryReg)\n    setLibs(query ? query[1].split(',') : [])\n  }, [search])\n\n  return (\n    <LibsContext.Provider value={libs}>\n      {children}\n    </LibsContext.Provider>\n  )\n}\n\nexport const useLibs = () => useContext(LibsContext)","import React, { useState, useMemo } from 'react'\nimport { Card, Empty } from 'antd'\nimport { Axis, Chart, LineAdvance } from 'bizcharts'\nimport numeral from 'numeral'\nimport moment from 'moment'\nimport { useNpmRangeData } from '../api'\nimport Options, { Range, TimeType } from './downloads-options'\nimport { useLibs } from '../store'\n\n\ninterface DataItem {\n  downloads: number\n  day: string\n  lib: string\n  duration?: string\n}\n\nconst lastYear = [moment().subtract(1, 'year'), moment().subtract(1, 'day')]\nconst lastYearStr = lastYear.map(r => r.format('YYYY-MM-DD')).join(':')\n\nexport default () => {\n  const libs = useLibs()\n  const [dateRange, setDateRange] = useState<Range | null>(lastYear as Range)\n  const [rangeStr, setRangeStr] = useState(lastYearStr)\n  const [timeType, setTimeType] = useState<TimeType>('weekly')\n  const [excludeWeekends, setExcludeWeekends] = useState(true)\n  const { data: downloads, error, isValidating } = useNpmRangeData(rangeStr || lastYearStr, ...libs)\n\n  const data = useMemo(() => {\n    if (!downloads) {\n      return []\n    }\n    \n    const dd = libs.reduce<DataItem[]>((r, n) => {\n      const packageDownloads = downloads[n]\n      if (packageDownloads) {\n        return r.concat(packageDownloads.downloads.map(\n          (dl) => ({ ...dl, lib: n })\n        ))\n      }\n\n      return r\n    }, [])\n\n    return dd\n  }, [downloads, libs])\n\n  // 排除掉周末的数据\n  const dataWithoutWeekends = useMemo(() => {\n    return data.filter(({ day }) => moment(day).isoWeekday() < 6)\n  }, [data])\n\n  // 按周汇总的数据\n  const dataWeekly = useMemo(() => {\n    if (!downloads) {\n      return []\n    }\n\n    return libs.reduceRight<DataItem[]>((result, lib) => {\n      const libDownloads = downloads[lib]?.downloads || []\n      \n      let lastDay: moment.Moment | null = null\n      let item: DataItem = {\n        downloads: 0,\n        lib,\n        day: '',\n      }\n\n      for(let i = libDownloads.length - 1; i >= 0; i--) {\n        const ld = libDownloads[i]\n        const day = moment(ld.day)\n        if (!lastDay) {\n          lastDay = moment(ld.day)\n        }\n\n        const diffDay = lastDay.diff(day, 'day')\n        if (diffDay <= 6) {\n          item.downloads += ld.downloads\n        }\n        // 第七天 保存数据\n        if (diffDay === 6) {\n          item.duration = `${day.format('YYYY-MM-DD')} to ${lastDay.format('YYYY-MM-DD')}`\n          item.day = lastDay.format('YYYY-MM-DD')\n          result.unshift(item)\n\n          // 初始化下一个七天\n          lastDay = null\n          item = {\n            day: '',\n            downloads: 0,\n            lib,\n          }\n        }\n      }\n\n      return result\n    }, [])\n  }, [downloads, libs])\n\n  return (\n    <Card\n      title='NPM Downloads'\n      extra={(\n        <Options\n          range={dateRange}\n          onRangeChange={(range, rangeStrs) => {\n            setDateRange(range)\n            setRangeStr(range ? rangeStrs.join(':') : '')\n          }}\n          timeType={timeType}\n          onTimeTypeChange={setTimeType}\n          excludeWeekends={excludeWeekends}\n          onExcludeChange={setExcludeWeekends}\n        />\n      )}\n    >\n      <Chart\n        padding={[10, 50, 50]}\n        height={300}\n        autoFit\n        data={timeType === 'weekly' ? dataWeekly : excludeWeekends ? dataWithoutWeekends : data}\n        scale={{\n          downloads: {\n            min: 0,\n          }\n        }}\n      >\n        <Axis\n          name='downloads'\n          label={{\n            formatter: (text) => `${numeral(text).divide(1000).value()}K`\n          }}\n        />\n        <LineAdvance\n          shape='smooth'\n          area\n          position='day*downloads'\n          color='lib'\n          tooltip={[\n            'lib*downloads*duration*day',\n            (name, dls, duration, day) => ({\n              name,\n              value: numeral(dls).format('0,0'),\n              title: duration || day\n            })\n          ]}\n        />\n        {downloads ? null : (\n          <Empty\n            style={{\n              position: 'absolute',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)',\n            }}\n            description={error || isValidating ? 'loading...' : 'No Data'}\n          />\n        )}\n      </Chart>\n    </Card>\n  )\n}\n","import React, { useState, useCallback, useEffect } from 'react'\nimport { PageHeader, Space, Input, Tag, Button } from 'antd'\nimport { GithubOutlined } from '@ant-design/icons'\nimport { useHistory } from 'react-router-dom'\nimport { useLibs } from '../store'\n\nexport default () => {\n  const history = useHistory()\n  const libsInUrl = useLibs()\n  const [libs, setLibs] = useState<string[]>(libsInUrl)\n  const [newLib, setNewLib] = useState<string>('')\n\n  useEffect(() => {\n    setLibs(prevLibs => {\n      if (prevLibs.join(',') !== libsInUrl.join(',')) {\n        return libsInUrl\n      }\n\n      return prevLibs\n    })\n  }, [libsInUrl])\n\n  const addNewLib = useCallback(() => {\n    if (newLib) {\n      setLibs(libs => {\n        if (libs.includes(newLib)) {\n          return libs\n        }\n\n        return libs.concat(newLib)\n      })\n      setNewLib('')\n    }\n  }, [newLib])\n\n  return (\n    <PageHeader\n      title='JS Compare'\n      backIcon={false}\n      extra={(\n        <a\n          href='https://github.com/guofei0723/jslib-compare'\n          style={{\n            fontSize: '1.5em',\n            color: 'inherit',\n          }}\n        >\n          <GithubOutlined />\n        </a>\n      )}\n    >\n      <Space direction='vertical'>\n        <div style={{ display: 'inline-block' }}>\n          {libs.map(lib => (\n            <Tag\n              key={lib}\n              closable\n              onClose={() => setLibs(libs.filter(l => l !== lib))}\n            >\n              {lib}\n            </Tag>\n          ))}\n          <Space>\n            <Input\n              size='small'\n              type='text'\n              value={newLib}\n              onPressEnter={addNewLib}\n              onChange={(e) => setNewLib(e.target.value)}\n              style={{\n                width: '160px',\n              }}\n              placeholder='add js library'\n              addonAfter={(\n                <Button\n                  type='text'\n                  size='small'\n                  onClick={addNewLib}\n                  disabled={!newLib}\n                  style={{\n                    height: 22,\n                    border: 0,\n                    padding: 0,\n                  }}\n                >\n                  +\n                </Button>\n              )}\n            />\n            <Button\n              size='small'\n              danger\n              onClick={() => setLibs([])}\n              disabled={libs.length === 0}\n            >\n              clear\n            </Button>\n          </Space>\n        </div>\n        <Button\n          type='primary'\n          onClick={() => history.push(`/?libs=${libs.join(',')}`)}\n          disabled={libs === libsInUrl || libs.length === 0}\n        >\n          Compare\n        </Button>\n      </Space>\n    </PageHeader>\n  )\n}\n","import React from 'react'\nimport { Layout, Space } from 'antd'\nimport {\n  BrowserRouter as Router,\n  Route,\n  Switch,\n} from 'react-router-dom'\nimport { SWRConfig } from 'swr'\nimport './App.less'\nimport { DownloadsChart, TheHeader } from './components'\nimport { LibsProvider } from './store'\n\nconst { Content } = Layout\n\nfunction App() {\n  return (\n    <Router basename={process.env.PUBLIC_URL}>\n      <div className='App'>\n        <Layout style={{ minHeight: '100%' }}>\n          <Content>\n            <Switch>\n              <Route path='/'>\n                <SWRConfig\n                  value={{\n                    revalidateOnFocus: false,\n                    shouldRetryOnError: false,\n                  }}\n                >\n                  <LibsProvider>\n                    <TheHeader />\n                    <Space direction='vertical' style={{ display: 'flex', padding: '0 24px'}} size='large'>\n                      <DownloadsChart />\n                    </Space>\n                  </LibsProvider>\n                </SWRConfig>\n              </Route>\n            </Switch>\n          </Content>\n        </Layout>\n      </div>\n    </Router>\n  );\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config: any) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config: any) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config: any) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.less'\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}